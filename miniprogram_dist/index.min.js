"use strict";function inherit(n,o){return Object.getOwnPropertyNames(n.__proto__).forEach(t=>{"constructor"!==t&&(o.__proto__[t]=n.__proto__[t])}),o}class CanvasExtensions{testLog(){console.log("CanvasExtensions")}}class ContexExtensions{async view({color:t="#000",w:n=10,h:o=10,x:e=0,y:s=0,r:a=0,cb:r=()=>{}}){return this.beginPath(),this.fillStyle=t,this.arc(e+a,s+a,a,Math.PI,1.5*Math.PI),this.moveTo(e+a,s),this.lineTo(e+n-a,s),this.lineTo(e+n,s+a),this.arc(e+n-a,s+a,a,1.5*Math.PI,2*Math.PI),this.lineTo(e+n,s+o-a),this.lineTo(e+n-a,s+o),this.arc(e+n-a,s+o-a,a,0,.5*Math.PI),this.lineTo(e+a,s+o),this.lineTo(e,s+o-a),this.arc(e+a,s+o-a,a,.5*Math.PI,Math.PI),this.lineTo(e,s+a),this.lineTo(e+a,s),this.fill(),this.closePath(),await r.call(this),"success"}image({image:t="",color:n="#fff",x:o=0,y:e=0,w:s=10,h:a=10,r=10}){this.view({color:n,x:o,y:e,w:s,h:a,r:r,cb:()=>{this.drawImage(t,o,e,s,a)}})}text({context:t="默认文字",x:n=0,y:o=0,size:e=12,color:s="#fff"}){this.font=`400 ${e}px -apple-system-font, Helvetica Neue, Helvetica, sans-serif`,this.fillStyle=s,this.textBaseline="top",this.textAlign="left",this.fillText(t,n,o)}}const CanvasExtension=function(t){return inherit(new CanvasExtensions,t)},ContexExtension=function(t){return inherit(new ContexExtensions,t)};function flattenFnArray(t,s,a){return t=Array.isArray(t)?t:[t],s=Array.isArray(s)?s:[s],a=Array.isArray(a)?a:[a],function(e){return t.reduce((t,n,o)=>t.then(()=>n(s[o],a[o],e)),Promise.resolve())}}function createCanvas(t,n){const o=wx.createOffscreenCanvas({type:"2d",width:t,height:n});return{canvas:CanvasExtension(o),ctx:ContexExtension(o.getContext("2d"))}}function settingCanvas(t){t.posterStatus=BOOTSTRAP;let n=t.onBootstrap.map(t=>createCanvas(t.customProp.width,t.customProp.height)),o=t.onBootstrap.map(t=>t.customProp),e=t.onBootstrap.map(t=>t.app);void 0!==INDEX&&(n=n[INDEX],o=o[INDEX],e=e[INDEX]),flattenFnArray(e,n,o)().then(()=>{t.posterStatus=NOT_MOUNT,start(t)})}function renderCanvas(t){console.log("renderCanvas",t),t.posterStatus=MOUNT,t.onMount.call(t,"renderCanvas callback"),t.posterStatus=NOT_UNMOUNT,start(t)}function destroyCanvas(t){console.log("destroyCanvas",t),t.onUnmount.call(t),t.posterStatus=UNMOUNT}function start(t){switch(t.posterStatus){case NOT_BOOTSTRAP:case UNMOUNT:settingCanvas(t);break;case NOT_MOUNT:renderCanvas(t);break;case NOT_UNMOUNT:destroyCanvas(t)}}const NOT_BOOTSTRAP="NOT_BOOTSTRAP",BOOTSTRAP="BOOTSTRAP",NOT_MOUNT="NOT_MOUNT",MOUNT="MOUNT",NOT_UNMOUNT="NOT_UNMOUNT",UNMOUNT="UNMOUNT";let INDEX=void 0;const register=t=>n=>(n.posterStatus=NOT_BOOTSTRAP,Object.prototype.hasOwnProperty.call(n,"onBootstrap")||(n.onBootstrap=[]),Array.isArray(n.onBootstrap)||(n.onBootstrap=[n.onBootstrap]),Object.prototype.hasOwnProperty.call(n,"onMount")||(n.onMount=function(){}),Object.prototype.hasOwnProperty.call(n,"onUnmount")||(n.onUnmount=function(){}),Object.prototype.hasOwnProperty.call(n,"onStart")||(n.onStart=function(t){INDEX=void 0!==t?t:void 0,start(n)}),t(n));Page=register(Page);
